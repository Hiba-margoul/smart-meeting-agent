<div class="meethub-wrapper">

  <div class="header-soft-bg position-relative">
    <div class="container px-4 py-4 d-flex align-items-center gap-3">

      <!-- Bouton retour + titre -->
      <div class="d-flex align-items-center gap-3">
        <button class="btn btn-back shadow-sm" (click)="goBack()">
          <div class="icon-box bg-primary-subtle text-primary">
            <img src="retour.png" alt="Retour" class="icon-img">
          </div>
        </button>
        <div>
          <h1 class="page-title mb-0">Nouveau Meeting</h1>
          <p class="page-subtitle">Configurez les détails de votre réunion</p>
        </div>
      </div>

    </div>

    <!-- Logo centré -->
    <div class="logo-center position-absolute top-50 start-50 translate-middle">
      <img src="join.png" alt="Logo central" class="logo-center-img">
    </div>
  </div>


  <div class="container px-4 mt-n-5">
    <div class="row justify-content-center">
      <div class="col-lg-7 col-xl-6">

        <div class="card content-card border-0 shadow-sm">
          <div class="card-body p-4 p-md-5">

            <form [formGroup]="form" (ngSubmit)="createMeet()">

              <div class="mb-4">
                <label class="form-label fw-bold text-dark">Titre de la réunion</label>
                <div class="input-icon-wrapper">
                  <i class="bi bi-type-h1 text-muted"></i>
                  <input
                    type="text"
                    class="form-control form-custom"
                    formControlName="title"
                    placeholder="Ex: Review Sprint Q1..."
                    [class.is-invalid]="form.get('title')?.touched && form.get('title')?.invalid">
                </div>
                <div class="invalid-feedback d-block" *ngIf="form.get('title')?.touched && form.get('title')?.invalid">
                  Le titre est requis.
                </div>
              </div>

              <div class="mb-4">
                <label class="form-label fw-bold text-dark d-flex justify-content-between">
                  <span>Participants</span>
                  <span class="badge bg-primary-subtle text-primary border border-primary-subtle">
                    {{ form.get('userInvitedsSelected')?.value?.length || 0 }} sélectionné(s)
                  </span>
                </label>

                <div class="checkbox-list-container form-custom h-auto py-2"
                     [class.border-danger]="form.get('userInvitedsSelected')?.touched && form.get('userInvitedsSelected')?.invalid">

                  <div class="d-flex flex-column gap-2" style="max-height: 200px; overflow-y: auto;">

                    <div class="form-check custom-checkbox-item px-4" *ngFor="let user of users">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        [value]="user.email"
                        (change)="onCheckboxChange($event)"
                        [id]="'user-' + user.email">
                      <label class="form-check-label w-100 cursor-pointer" [for]="'user-' + user.email">
                        <div class="d-flex align-items-center">
                          <div class="avatar-small me-2">{{ user.email.charAt(0).toUpperCase() }}</div>
                          <span class="text-dark">{{ user.email }}</span>
                        </div>
                      </label>
                    </div>

                  </div>
                </div>

                <div class="invalid-feedback d-block" *ngIf="form.get('userInvitedsSelected')?.touched && form.get('userInvitedsSelected')?.invalid">
                  Sélectionnez au moins un participant.
                </div>
              </div>

              <div class="mb-4">
                <label class="form-label fw-bold text-dark">Modèle de Rapport (Optionnel)</label>
                <div class="input-icon-wrapper">
                  <i class="bi bi-file-earmark-text text-muted"></i>
                  <select
                    class="form-select form-custom ps-5"
                    formControlName="reportTemplateId">
                    <option value="" selected>-- Aucun modèle (Standard) --</option>
                    <option *ngFor="let template of templates" [value]="template.id">
                      {{ template.name }}
                    </option>
                  </select>
                </div>
                <div class="d-flex justify-content-end mt-2">
                  <a (click)="goToTemplate()" class="text-decoration-none small fw-semibold text-primary">
                    <i class="bi bi-plus-circle me-1"></i>Créer un nouveau modèle
                  </a>
                </div>
              </div>

              <div *ngIf="errorMessage" class="alert alert-danger d-flex align-items-center mb-4">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <div>{{ errorMessage }}</div>
              </div>

              <div class="d-grid gap-3 mt-5">
                <button type="submit" class="btn btn-primary btn-lg shadow-sm" [disabled]="form.invalid">
                  <i class="bi bi-check2-circle me-2"></i> Créer la réunion
                </button>
                <button type="button" class="btn btn-link text-muted text-decoration-none" (click)="goBack()">
                  Annuler et revenir
                </button>
              </div>

            </form>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
