<div class="meethub-wrapper">

  <div class="header-soft-bg">
    <div class="container-fluid px-3 px-md-4 py-4 d-flex flex-wrap justify-content-between align-items-center gap-3">

      <!-- Logo + Titre -->
      <div class="d-flex align-items-center gap-3">
        <img src="join.png" alt="Logo" class="logo-header">
        <div>
          <h1 class="page-title mb-1">Gestion des Réunions</h1>
          <p class="page-subtitle mb-0">Bienvenue sur votre espace de gestion des réunions</p>
        </div>
      </div>

      <!-- Boutons -->
      <div class="d-flex gap-2">
        <button class="btn btn-primary btn-create shadow-sm text-nowrap" (click)="createMeet()">
          <i class="bi bi-plus-lg me-2"></i> Create Meet
        </button>
        <button class="btn btn-outline-danger rounded-pill px-4 shadow-sm btn-logout"
                (click)="logout()">
          <i class="bi bi-box-arrow-right me-2"></i> Logout
        </button>
      </div>

    </div>
  </div>


  <div class="container-fluid px-3 px-md-4 mt-n-5"> <div class="row g-3 mb-4">

    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card stat-card border-0 shadow-sm h-100">
        <div class="card-body p-3 d-flex justify-content-between align-items-start">
          <div>
            <p class="text-muted small text-uppercase fw-bold mb-1">Total Réunions</p>
            <h3 class="mb-0 fw-bold text-dark">{{ stats.total }}</h3>
            <span class="badge bg-success-subtle text-success mt-2 rounded-pill">
                <i class="bi bi-arrow-up"></i> +12%
              </span>
          </div>
          <div class="icon-box bg-primary-subtle text-primary">
            <img src="icon1.png" alt="Calendrier">
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card stat-card border-0 shadow-sm h-100">
        <div class="card-body p-3 d-flex justify-content-between align-items-start">
          <div>
            <p class="text-muted small text-uppercase fw-bold mb-1">En Cours</p>
            <h3 class="mb-0 fw-bold text-dark">{{ stats.active }}</h3>
            <span class="badge bg-success-subtle text-success mt-2 rounded-pill">Actif maintenant</span>
          </div>
          <div class="icon-box bg-primary-subtle text-primary">
            <img src="icon3.png" alt="Calendrier">
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card stat-card border-0 shadow-sm h-100">
        <div class="card-body p-3 d-flex justify-content-between align-items-start">
          <div>
            <p class="text-muted small text-uppercase fw-bold mb-1">Terminées</p>
            <h3 class="mb-0 fw-bold text-dark">{{ stats.finished }}</h3>
            <span class="badge bg-info-subtle text-info mt-2 rounded-pill">
                <i class="bi bi-check2"></i> Validées
              </span>
          </div>
          <div class="icon-box bg-primary-subtle text-primary">
            <img src="icon2.png" alt="Calendrier">
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-sm-6 col-xl-3">
      <div class="card stat-card border-0 shadow-sm h-100">
        <div class="card-body p-3 d-flex justify-content-between align-items-start">
          <div>
            <p class="text-muted small text-uppercase fw-bold mb-1">Planifiées</p>
            <h3 class="mb-0 fw-bold text-dark">{{ stats.planned }}</h3>
            <span class="badge bg-warning-subtle text-warning mt-2 rounded-pill">
                <i class="bi bi-clock"></i> À venir
              </span>
          </div>
          <div class="icon-box bg-primary-subtle text-primary">
            <img src="icon4.png" alt="Calendrier">
          </div>
        </div>
      </div>
    </div>

  </div>
    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-body p-3 p-md-4">
        <div class="row g-3 mb-4 align-items-center justify-content-between">
          <div class="col-12 col-lg-auto">
            <div class="status-tabs p-1 rounded-pill bg-light d-flex flex-nowrap overflow-auto">
              <button class="tab-pill flex-fill" [class.active]="statusFilter==='ALL'" (click)="changeStatusFilter('ALL')">Tous</button>
              <button class="tab-pill flex-fill" [class.active]="statusFilter==='PLANNED'" (click)="changeStatusFilter('PLANNED')">Prévu</button>
              <button class="tab-pill flex-fill" [class.active]="statusFilter==='ACTIVE'" (click)="changeStatusFilter('ACTIVE')">Actif</button>
              <button class="tab-pill flex-fill" [class.active]="statusFilter==='FINISHED'" (click)="changeStatusFilter('FINISHED')">Terminé</button>
            </div>
          </div>

          <div class="col-12 col-lg-auto">
            <div class="row g-2">
              <div class="col-12 col-md-5">
                <div class="input-group-clean w-100">
                  <i class="bi bi-search text-muted"></i>
                  <input type="text" class="w-100" placeholder="Rechercher..." [(ngModel)]="searchTerm" (ngModelChange)="onSearch(searchTerm)">
                </div>
              </div>
              <div class="col-6 col-md-3">
                <input type="date" class="date-input-clean w-100" [(ngModel)]="startDateFilter" (ngModelChange)="onStartDateChange(startDateFilter)">
              </div>
              <div class="col-6 col-md-4">
                <input type="date" class="date-input-clean w-100" [(ngModel)]="endDateFilter" (ngModelChange)="onEndDateChange(endDateFilter)">
              </div>
            </div>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table align-middle table-hover custom-table text-nowrap">
            <thead class="bg-light">
            <tr>
              <th class="ps-3">Titre</th>
              <th>Date de début</th>
              <th>Date de fin</th>
              <th>Status</th>
              <th>Invités</th>
              <th>Rapport</th>
              <th class="text-end pe-3">Action</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngIf="paginatedMeets.length === 0">
              <td colspan="7" class="text-center text-muted py-5">
                <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                Aucune réunion trouvée.
              </td>
            </tr>

            <tr *ngFor="let meet of paginatedMeets">
              <td class="ps-3 fw-semibold text-dark">{{ meet.title }}</td>
              <td class="text-secondary">{{ meet.startedAt | date:'dd MMM yyyy, HH:mm' }}</td>
              <td class="text-secondary">{{ meet.endedAt | date:'dd MMM yyyy, HH:mm' }}</td>
              <td>
                    <span class="status-badge"
                          [ngClass]="{
                          'status-planned': meet.status==='PLANNED',
                          'status-active': meet.status==='ACTIVE',
                          'status-finished': meet.status==='FINISHED'
                        }">
                      {{ meet.status === 'PLANNED' ? 'Prévu' : meet.status === 'ACTIVE' ? 'Actif' : 'Terminé' }}
                    </span>
              </td>
              <td>
                <div class="avatar-stack">
                  <span class="avatar-circle">SM</span>
                  <span class="avatar-circle bg-info-subtle text-info" *ngIf="meet.invitedUserIds.length > 1">JD</span>
                  <span class="avatar-circle bg-secondary-subtle text-secondary" *ngIf="meet.invitedUserIds.length > 2">+{{ meet.invitedUserIds.length - 2 }}</span>
                </div>
              </td>
              <td>
                <button *ngIf="meet.reportGenerated" class="btn btn-sm btn-light text-primary border-0" (click)="openPdfPanel(meet)">
                  <div class="icon-box1 bg-primary-subtle text-primary">
                    <img  src="see_report.png" alt="Report">
                  </div>
                </button>
                <span *ngIf="!meet.reportGenerated" class="text-muted small">-</span>
              </td>
              <td class="text-end pe-3">
                <div class="d-flex justify-content-end gap-2">
                  <button *ngIf="meet.status === 'FINISHED'" class="btn btn-sm  rounded-pill px-3" >
                    <div class="icon-box1 bg-primary-subtle text-primary">
                      <img  src="done.png" alt="Report">
                    </div>
                  </button>
                  <button *ngIf="meet.status !== 'FINISHED'" class="btn btn-sm btn-outline-secondary rounded-pill px-3" (click)="joinMeet(meet.id)">
                    <div class="icon-box1 bg-primary-subtle text-primary">
                      <img  src="icon1.png" alt="Report">
                    </div>
                  </button>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>

        <div class="d-flex flex-wrap justify-content-between align-items-center mt-4 border-top pt-3 gap-2" *ngIf="totalPages > 1">
             <span class="text-muted small order-2 order-md-1 w-100 w-md-auto text-center text-md-start">
               Affichage {{paginatedMeets.length}} sur {{filtredMeet.length}} réunions
             </span>

          <nav class="order-1 order-md-2 w-100 w-md-auto d-flex justify-content-center">
            <ul class="pagination pagination-sm mb-0">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <button class="page-link border-0 rounded-start-pill" (click)="changePage(currentPage - 1)">«</button>
              </li>
              <li class="page-item" *ngFor="let page of pagesArray" [class.active]="currentPage === page">
                <button class="page-link border-0" (click)="changePage(page)">{{ page }}</button>
              </li>
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <button class="page-link border-0 rounded-end-pill" (click)="changePage(currentPage + 1)">»</button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <div class="pdf-panel shadow-lg" *ngIf="pdfPanelOpen">
    <div class="pdf-panel-header p-3 d-flex justify-content-between align-items-center border-bottom bg-light">
      <h5 class="m-0 text-truncate">Aperçu du Rapport</h5>
      <button class="btn-close" (click)="closePdfPanel()"></button>
    </div>
    <div class="p-2 border-bottom d-flex gap-2 justify-content-end bg-white">
      <button class="btn btn-sm btn-outline-primary flex-grow-1 flex-md-grow-0" (click)="downloadPdf()">Télécharger</button>
      <button class="btn btn-sm btn-outline-warning flex-grow-1 flex-md-grow-0" (click)="editReport()">Éditer</button>
    </div>
    <div class="h-100 bg-light">
      <iframe *ngIf="pdfUrl" [src]="pdfUrl | safeUrl" width="100%" height="100%" class="border-0"></iframe>
    </div>
  </div>

</div>
